# ---------------------------------------------------------------------
# RPM Spec File for the ML Kit
# ---------------------------------------------------------------------
#
# Do NOT modify the file "kit/mlkit.spec" directly - it is generated
# from "kit/mlkit.spec.in" and based on the file "kit/version"; See 
# the file "kit/Makefile" for details.
#
# Here is a short description of how to build an RPM File for the ML
# Kit. First, check that you can build the Kit with the shell command
#
#   $ make
#
# from within the ML Kit root directory. You must also be able to
# install the Kit in /usr/share/mlkit with the command (you need to be
# root to do this)
# 
#   # make install
#
# The install section in the Makefile copies all files that the end
# user needs to run the kit into the /usr/share/mlkit directory. Here
# you need to be careful that the files that are copied are also
# mentioned in the %files section of this spec file.
#
# Before you can actually build the rpm file, you need to construct a
# gzipped tar file containing the ML Kit sources, unless you already
# have such a gzipped tar file. To create the gzipped tar file, execute 
# the command
#
#   $ make tgz
#
# from within the ML Kit root directory. Also, execute the command:
#
#   $ make mlkit.spec
#
# which will generate the mlkit.spec file from the generic file 
# mlkit.spec.in. Now (as root) copy the generated spec-file and
# generated tgz-file:
#
#   # cp mlkit.spec /usr/src/redhat/SPECS/mlkit-@VERSION@.spec
#   # cp ../mlkit-@VERSION@.tgz /usr/src/redhat/SOURCES/
#
# You are now ready for the build:
#
#   # cd /usr/src/redhat/SPECS
#   # rpm -ba mlkit-@VERSION@.spec
# 
# ---------------------------------------------------------------------

Summary: A Standard ML compiler
Name: mlkit
Version: @VERSION@
Release: 1
Copyright: GPL
Group: Development/Languages
Source: http://www.itu.dk/research/mlkit/download/mlkit-@VERSION@.tgz
URL: http://www.itu.dk/research/mlkit
Vendor: IT University of Copenhagen
Packager: Martin Elsman (mael@itu.dk)
Prefix: /usr/share/mlkit
ExclusiveOS: Linux
ExcludeArch: sparc alpha

%description 

The ML Kit (henceforth refered to as the Kit) is a compiler for the
programming language Standard ML. The Kit covers all of Standard
ML, as defined in the 1997 edition of the Definition of Standard ML
and supports most of the Standard ML Basis Library. The Kit uses a
region based memory management scheme in which allocation and
deallocation primitives are inserted into the program at compile 
time. The Kit also makes it possible to combine the region based 
memory management scheme with traditional pointer tracing garbage
collection. Two versions of the the Kit are available, one that
generates efficient native code for the x86 architecture and one that
generates portable bytecode to be interpreted by an abstract
machine. The ML Kit has successfully compiled itself, around 80.000
lines of Standard ML, plus the Basis Library.

%prep
%setup

%build
make

%install
rm -rf $RPM_BUILD_ROOT
make install

%clean
rm -rf $RPM_BUILD_ROOT

%files

#
# Documentation, Etc.
#
%doc /usr/share/mlkit/doc/mlkit.pdf
%doc /usr/share/mlkit/README
/usr/share/mlkit/copyright

# ML Kit Executables
/usr/share/mlkit/bin/mlkit.x86-linux
/usr/share/mlkit/bin/mlkit
/usr/share/mlkit/bin/rp2ps
/usr/bin/mlkit
/usr/bin/rp2ps

# Runtime Systems
/usr/share/mlkit/bin/runtimeSystem.a
/usr/share/mlkit/bin/runtimeSystemGC.a
/usr/share/mlkit/bin/runtimeSystemProf.a
/usr/share/mlkit/bin/runtimeSystemGCProf.a 
/usr/share/mlkit/bin/runtimeSystemTag.a 

# The Demonstration Directory
/usr/share/mlkit/kitdemo

# Libraries
/usr/share/mlkit/ml-yacc-lib
/usr/share/mlkit/basis

%post
echo '#!/bin/sh' > ${RPM_INSTALL_PREFIX}/bin/mlkit
echo ''${RPM_INSTALL_PREFIX}/bin/mlkit.x86-linux ${RPM_INSTALL_PREFIX}' $*' >> ${RPM_INSTALL_PREFIX}/bin/mlkit
chmod a+x ${RPM_INSTALL_PREFIX}/bin/mlkit
ln -sf ${RPM_INSTALL_PREFIX}/bin/mlkit /usr/bin/mlkit
ln -sf ${RPM_INSTALL_PREFIX}/bin/rp2ps /usr/bin/rp2ps

